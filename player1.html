<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Player 1</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <main class="card">
    <h1>Player 1 üß©</h1>
    <p>Don‚Äôt show this screen to Player 2. Communicate answers only.</p>
    <p class="small">Game: <span class="code" id="seedTag"></span></p>

    <div class="section" id="S1">
      <h2>Room 1: The Desk</h2>
      <p>You find a note: <span class="code">‚ÄúShift letters by +3‚Äù</span></p>
      <p>Encrypted word: <span class="code">ODSQB</span></p>
      <p>Decrypt it and tell Player 2 the word.</p>
      <details class="small"><summary>Hint</summary> Caesar shift forward/back.</details>
      <p class="small">After Player 2 uses your word, they‚Äôll give you a 6-char code to enter below.</p>

      <hr/>
      <div class="row">
        <input id="p2code" placeholder="Enter code from Player 2" />
        <button id="unlock">Unlock next</button>
      </div>
      <p id="msg" class="small"></p>
    </div>

    <div class="section locked" id="S2">
      <h2>Room 2: The Locker</h2>
      <p>A keypad asks for a 4-digit PIN. You see: <span class="code">2 + 0 + 2 + 6</span>.</p>
      <p>PIN is the year‚Ä¶ but <i>concatenate</i> the numbers you get from that sum (talk it out with Player 2).</p>
      <div class="row">
        <input id="pin" placeholder="4-digit PIN" />
        <button id="pinBtn" class="secondary">Submit</button>
      </div>
      <p id="pinMsg" class="small"></p>
      <p class="small">When correct, you‚Äôll receive a code to send Player 2.</p>
      <p class="small">Code for Player 2: <span class="code" id="outCode"></span></p>
    </div>

    <div class="section locked" id="S3">
      <h2>Final: Exit</h2>
      <p>Tell Player 2 your final phrase: <span class="code">‚ÄúOPEN THE DOOR‚Äù</span></p>
      <p class="small">You made it üéâ</p>
    </div>
  </main>

  <script src="game.js"></script>
  <script>
    requireSeedOrRedirect();
    document.getElementById("seedTag").textContent = getSeed();

    // Locks
    initLocks(["S1","S2","S3"], "p1");

    // Room 1 answer (for Player 2): ODSQB with -3 => LAPKY? Actually check:
    // We'll keep it as a "communicate the decrypted word" puzzle; you can change later.

    // Gate: expects Player 2 to send codeFrom(seed, "P2_TO_P1_R1")
    const gate = gatePartnerCode({
      role:"p1",
      expectedLabel:"P2_TO_P1_R1",
      inputId:"p2code",
      nextSectionId:"S2",
      messageId:"msg"
    });
    document.getElementById("unlock").addEventListener("click", gate.attempt);

    // Room 2 PIN logic (custom): we'll set a deterministic pin from seed too
    const pinExpected = (parseInt(getSeed().slice(0,2), 36) % 9000) + 1000; // 1000-9999
    document.getElementById("pinBtn").addEventListener("click", () => {
      const v = (document.getElementById("pin").value || "").trim();
      const pinMsg = document.getElementById("pinMsg");
      if (v === String(pinExpected)){
        pinMsg.textContent = "‚úÖ Locker opened!";
        const codeForP2 = codeFrom(getSeed(), "P1_TO_P2_R2");
        document.getElementById("outCode").textContent = codeForP2;
        unlockSection("S3");
        markUnlocked("p1", "S3");
      } else {
        pinMsg.textContent = "‚ùå Wrong PIN.";
      }
    });
  </script>
</body>
</html>
