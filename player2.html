<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Player 2</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <main class="card">
    <h1>Player 2 üîé</h1>
    <p>Don‚Äôt show this screen to Player 1. Communicate answers only.</p>
    <p class="small">Game: <span class="code" id="seedTag"></span></p>

    <div class="section" id="T1">
      <h2>Room 1: The Wall Safe</h2>
      <p>You see a sticky note: <span class="code">‚ÄúThe desk note is a Caesar cipher.‚Äù</span></p>
      <p>Ask Player 1 for the encrypted word and decrypt it with their hint.</p>
      <p>When you get the decrypted word, type it here:</p>
      <div class="row">
        <input id="word" placeholder="Decrypted word" />
        <button id="wordBtn">Open safe</button>
      </div>
      <p id="wordMsg" class="small"></p>
      <p class="small">When correct, send this code to Player 1:</p>
      <p><span class="code" id="codeToP1"></span></p>
    </div>

    <div class="section locked" id="T2">
      <h2>Room 2: The Circuit Box</h2>
      <p>Enter the 6-char code Player 1 gives you after opening their locker:</p>
      <div class="row">
        <input id="p1code" placeholder="Code from Player 1" />
        <button id="p1Btn" class="secondary">Unlock</button>
      </div>
      <p id="p1Msg" class="small"></p>
    </div>

    <div class="section locked" id="T3">
      <h2>Final: Exit</h2>
      <p>Player 1 has a final phrase. Enter it exactly:</p>
      <div class="row">
        <input id="phrase" placeholder="Final phrase" />
        <button id="phraseBtn" class="secondary">Finish</button>
      </div>
      <p id="done" class="small"></p>
    </div>
  </main>

  <script src="game.js"></script>
  <script>
    requireSeedOrRedirect();
    document.getElementById("seedTag").textContent = getSeed();
    initLocks(["T1","T2","T3"], "p2");

    // Deterministic correct word for Room 1 (you can replace with your own):
    // We'll set it to a seed-based word so it's not always the same.
    const correctWord = ("LOVE" + codeFrom(getSeed(),"WORD").slice(0,2)).toUpperCase();

    const codeToP1 = codeFrom(getSeed(), "P2_TO_P1_R1");
    document.getElementById("codeToP1").textContent = codeToP1;

    document.getElementById("wordBtn").addEventListener("click", () => {
      const v = (document.getElementById("word").value || "").trim().toUpperCase();
      const msg = document.getElementById("wordMsg");
      if (v === correctWord){
        msg.textContent = "‚úÖ Safe opened! Send the code to Player 1.";
        unlockSection("T2");
        markUnlocked("p2","T2");
      } else {
        msg.textContent = "‚ùå That word doesn‚Äôt open the safe. Ask Player 1 again / re-check shift.";
        msg.innerHTML += `<br/><span class="small">Tip: it should start with <b>LOVE</b>‚Ä¶</span>`;
      }
    });

    // Gate: expects Player 1 sends codeFrom(seed, "P1_TO_P2_R2")
    document.getElementById("p1Btn").addEventListener("click", () => {
      const expected = codeFrom(getSeed(), "P1_TO_P2_R2");
      const v = (document.getElementById("p1code").value || "").trim().toUpperCase();
      const msg = document.getElementById("p1Msg");
      if (v === expected){
        msg.textContent = "‚úÖ Circuit box restored!";
        unlockSection("T3");
        markUnlocked("p2","T3");
      } else {
        msg.textContent = "‚ùå Wrong code.";
      }
    });

    document.getElementById("phraseBtn").addEventListener("click", () => {
      const v = (document.getElementById("phrase").value || "").trim().toUpperCase();
      const done = document.getElementById("done");
      if (v === "OPEN THE DOOR"){
        done.textContent = "üéâ You escaped together! (Send Player 1 a victory message.)";
      } else {
        done.textContent = "Not quite ‚Äî ask Player 1 for the exact phrase.";
      }
    });
  </script>
</body>
</html>
